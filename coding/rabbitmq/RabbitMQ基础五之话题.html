<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RabbitMQ基础五之话题 | 编程练习生-周大伟</title>
    <meta name="description" content="有道无术，术尚可求；有术无道，止于术。">
    <link rel="icon" href="/images/index.jpg">
  <link rel="manifest" href="/images/index.jpg">
  <link rel="apple-touch-icon" href="/images/index.jpg">
  <meta http-quiv="pragma" cotent="no-cache">
  <meta http-quiv="expires" cotent="0">
  <meta http-quiv="pragma" cotent="no-cache, must-revalidate">
    
    <link rel="preload" href="/assets/css/0.styles.051786a9.css" as="style"><link rel="preload" href="/assets/js/app.b72606ea.js" as="script"><link rel="preload" href="/assets/js/2.009073d5.js" as="script"><link rel="preload" href="/assets/js/38.ed229447.js" as="script"><link rel="prefetch" href="/assets/js/10.8052dcd5.js"><link rel="prefetch" href="/assets/js/11.6c1bd076.js"><link rel="prefetch" href="/assets/js/12.fc9a82b6.js"><link rel="prefetch" href="/assets/js/13.5eb30f78.js"><link rel="prefetch" href="/assets/js/14.a639e12f.js"><link rel="prefetch" href="/assets/js/15.bdfbcd1a.js"><link rel="prefetch" href="/assets/js/16.695bd086.js"><link rel="prefetch" href="/assets/js/17.5678d4f2.js"><link rel="prefetch" href="/assets/js/18.8780292b.js"><link rel="prefetch" href="/assets/js/19.77f42d1b.js"><link rel="prefetch" href="/assets/js/20.e25c614a.js"><link rel="prefetch" href="/assets/js/21.4bbab9fb.js"><link rel="prefetch" href="/assets/js/22.bf87a705.js"><link rel="prefetch" href="/assets/js/23.f229c0fa.js"><link rel="prefetch" href="/assets/js/24.30eb8305.js"><link rel="prefetch" href="/assets/js/25.88743743.js"><link rel="prefetch" href="/assets/js/26.2d7e0aa2.js"><link rel="prefetch" href="/assets/js/27.5b310cb6.js"><link rel="prefetch" href="/assets/js/28.19aa4725.js"><link rel="prefetch" href="/assets/js/29.dad73ace.js"><link rel="prefetch" href="/assets/js/3.a4c489a8.js"><link rel="prefetch" href="/assets/js/30.247a8cea.js"><link rel="prefetch" href="/assets/js/31.92816731.js"><link rel="prefetch" href="/assets/js/32.79ee03ca.js"><link rel="prefetch" href="/assets/js/33.0f94f829.js"><link rel="prefetch" href="/assets/js/34.86d2419b.js"><link rel="prefetch" href="/assets/js/35.c0dc95d1.js"><link rel="prefetch" href="/assets/js/36.4f1a3095.js"><link rel="prefetch" href="/assets/js/37.971326b1.js"><link rel="prefetch" href="/assets/js/39.c8db9a95.js"><link rel="prefetch" href="/assets/js/4.244111db.js"><link rel="prefetch" href="/assets/js/40.0157514b.js"><link rel="prefetch" href="/assets/js/41.e51cbfee.js"><link rel="prefetch" href="/assets/js/42.6ff72c31.js"><link rel="prefetch" href="/assets/js/43.1dc8f614.js"><link rel="prefetch" href="/assets/js/44.b35909e1.js"><link rel="prefetch" href="/assets/js/45.e651b06f.js"><link rel="prefetch" href="/assets/js/46.e8817dcb.js"><link rel="prefetch" href="/assets/js/47.67e0fdfa.js"><link rel="prefetch" href="/assets/js/48.0b5a8c11.js"><link rel="prefetch" href="/assets/js/49.c99e5906.js"><link rel="prefetch" href="/assets/js/5.f444bec9.js"><link rel="prefetch" href="/assets/js/50.310f7068.js"><link rel="prefetch" href="/assets/js/51.3e2ea8de.js"><link rel="prefetch" href="/assets/js/52.d3faa73a.js"><link rel="prefetch" href="/assets/js/53.7b2fe8fc.js"><link rel="prefetch" href="/assets/js/54.36789f48.js"><link rel="prefetch" href="/assets/js/55.5744b5ef.js"><link rel="prefetch" href="/assets/js/56.4486a446.js"><link rel="prefetch" href="/assets/js/57.74a082da.js"><link rel="prefetch" href="/assets/js/58.13765365.js"><link rel="prefetch" href="/assets/js/59.b1d00ae4.js"><link rel="prefetch" href="/assets/js/6.a4439dba.js"><link rel="prefetch" href="/assets/js/60.33ec256f.js"><link rel="prefetch" href="/assets/js/61.fa42d696.js"><link rel="prefetch" href="/assets/js/62.e7d9236f.js"><link rel="prefetch" href="/assets/js/63.5b7372c4.js"><link rel="prefetch" href="/assets/js/64.76cf9f35.js"><link rel="prefetch" href="/assets/js/7.9892eb3b.js"><link rel="prefetch" href="/assets/js/8.f0a4679a.js"><link rel="prefetch" href="/assets/js/9.23798b95.js">
    <link rel="stylesheet" href="/assets/css/0.styles.051786a9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">编程练习生-周大伟</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">内容导航</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/info/我是谁.html" class="nav-link">生活随笔</a></li><li class="dropdown-item"><!----> <a href="/info/我是谁.html" class="nav-link">技术之道</a></li><li class="dropdown-item"><!----> <a href="/info/我是谁.html" class="nav-link">兴趣爱好</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">测试按钮</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>第一个选项组</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/coding/rabbitmq/www.baidu.com.html" class="nav-link">选项1</a></li><li class="dropdown-subitem"><a href="/coding/rabbitmq/www.baidu.com.html" class="nav-link">选项2</a></li><li class="dropdown-subitem"><a href="/coding/rabbitmq/www.baidu.com.html" class="nav-link">选项3</a></li></ul></li><li class="dropdown-item"><h4>第二个选项组</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/coding/rabbitmq/www.baidu.com.html" class="nav-link">选项4</a></li><li class="dropdown-subitem"><a href="/coding/rabbitmq/www.baidu.com.html" class="nav-link">选项5</a></li><li class="dropdown-subitem"><a href="/coding/rabbitmq/www.baidu.com.html" class="nav-link">选项6</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">技术方向</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/skill/Java/index.html" class="nav-link">Java杂谈</a></li><li class="dropdown-item"><!----> <a href="/skill/spring/index.html" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/skill/fore-end/index.html" class="nav-link">前端</a></li><li class="dropdown-item"><!----> <a href="/skill/linux/index.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/skill/mysql/index.html" class="nav-link">mysql</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">在线文档</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://cn.vuejs.org/v2/api/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.runoob.com/bootstrap/bootstrap-tutorial.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bootstrap
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="/info/" class="nav-link">在线工具</a></div><div class="nav-item"><a href="/info/我是谁.html" class="nav-link">个人信息</a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  传送门
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">内容导航</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/info/我是谁.html" class="nav-link">生活随笔</a></li><li class="dropdown-item"><!----> <a href="/info/我是谁.html" class="nav-link">技术之道</a></li><li class="dropdown-item"><!----> <a href="/info/我是谁.html" class="nav-link">兴趣爱好</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">测试按钮</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>第一个选项组</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/coding/rabbitmq/www.baidu.com.html" class="nav-link">选项1</a></li><li class="dropdown-subitem"><a href="/coding/rabbitmq/www.baidu.com.html" class="nav-link">选项2</a></li><li class="dropdown-subitem"><a href="/coding/rabbitmq/www.baidu.com.html" class="nav-link">选项3</a></li></ul></li><li class="dropdown-item"><h4>第二个选项组</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/coding/rabbitmq/www.baidu.com.html" class="nav-link">选项4</a></li><li class="dropdown-subitem"><a href="/coding/rabbitmq/www.baidu.com.html" class="nav-link">选项5</a></li><li class="dropdown-subitem"><a href="/coding/rabbitmq/www.baidu.com.html" class="nav-link">选项6</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">技术方向</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/skill/Java/index.html" class="nav-link">Java杂谈</a></li><li class="dropdown-item"><!----> <a href="/skill/spring/index.html" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/skill/fore-end/index.html" class="nav-link">前端</a></li><li class="dropdown-item"><!----> <a href="/skill/linux/index.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/skill/mysql/index.html" class="nav-link">mysql</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">在线文档</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://cn.vuejs.org/v2/api/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.runoob.com/bootstrap/bootstrap-tutorial.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bootstrap
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="/info/" class="nav-link">在线工具</a></div><div class="nav-item"><a href="/info/我是谁.html" class="nav-link">个人信息</a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  传送门
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>RabbitMQ系列</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/coding/rabbitmq/Centos7环境安装RabbitMQ.html" class="sidebar-link">Centos7环境安装rabbitmq</a></li><li><a href="/coding/rabbitmq/RabbitMQ基础之前置环境.html" class="sidebar-link">RabbitMQ基础之前置环境</a></li><li><a href="/coding/rabbitmq/RabbitMQ基础一之简单队列.html" class="sidebar-link">RabbitMQ基础一之简单队列</a></li><li><a href="/coding/rabbitmq/RabbitMQ基础二之工作队列.html" class="sidebar-link">RabbitMQ基础二之工作队列</a></li><li><a href="/coding/rabbitmq/RabbitMQ基础三之发布订阅.html" class="sidebar-link">RabbitMQ基础三之发布订阅</a></li><li><a href="/coding/rabbitmq/RabbitMQ基础四之路由.html" class="sidebar-link">RabbitMQ基础四之路由</a></li><li><a href="/coding/rabbitmq/RabbitMQ基础五之话题.html" class="active sidebar-link">RabbitMQ基础五之话题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coding/rabbitmq/RabbitMQ基础五之话题.html#images-rabbitmq-topicexchange-png-br" class="sidebar-link">!</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coding/rabbitmq/RabbitMQ基础五之话题.html#生产者改造" class="sidebar-link">生产者改造</a></li><li class="sidebar-sub-header"><a href="/coding/rabbitmq/RabbitMQ基础五之话题.html#消费者一改造" class="sidebar-link">消费者一改造</a></li><li class="sidebar-sub-header"><a href="/coding/rabbitmq/RabbitMQ基础五之话题.html#消费者二改造" class="sidebar-link">消费者二改造</a></li><li class="sidebar-sub-header"><a href="/coding/rabbitmq/RabbitMQ基础五之话题.html#消费者三改造" class="sidebar-link">消费者三改造</a></li><li class="sidebar-sub-header"><a href="/coding/rabbitmq/RabbitMQ基础五之话题.html#测试一把" class="sidebar-link">测试一把</a></li><li class="sidebar-sub-header"><a href="/coding/rabbitmq/RabbitMQ基础五之话题.html#话题交换机" class="sidebar-link">话题交换机</a></li></ul></li></ul></li><li><a href="/coding/rabbitmq/RabbitMQ基础六之rpc.html" class="sidebar-link">RabbitMQ基础六之rpc</a></li><li><a href="/coding/rabbitmq/RabbitMQ进阶一之消息持久化.html" class="sidebar-link">RabbitMQ进阶一之消息持久化</a></li><li><a href="/coding/rabbitmq/RabbitMQ进阶二之提交成功-事务.html" class="sidebar-link">RabbitMQ进阶二之提交成功-事务</a></li><li><a href="/coding/rabbitmq/RabbitMQ进阶三之提交成功-confirm.html" class="sidebar-link">RabbitMQ进阶三之提交成功-confirm</a></li><li><a href="/coding/rabbitmq/RabbitMQ进阶四之消费成功-应答.html" class="sidebar-link">RabbitMQ进阶四之消费成功-应答</a></li><li><a href="/coding/rabbitmq/RabbitMQ进阶五之死信队列.html" class="sidebar-link">RabbitMQ进阶五之死信队列</a></li><li><a href="/coding/rabbitmq/RabbitMQ进阶六之延迟消费.html" class="sidebar-link">RabbitMQ进阶六之延迟消费</a></li><li><a href="/coding/rabbitmq/RabbitMQ进阶七之顺序消费.html" class="sidebar-link">RabbitMQ进阶七之顺序消费</a></li><li><a href="/coding/rabbitmq/更多~.html" class="sidebar-link">更多~</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="rabbitmq基础五之话题"><a href="#rabbitmq基础五之话题" aria-hidden="true" class="header-anchor">#</a> RabbitMQ基础五之话题</h1> <hr> <h2 id=""><a href="#" aria-hidden="true" class="header-anchor">#</a> <img src="/images/rabbitmq/topicExchange.png" alt=""><br></h2> <p>上篇我们学习了DirectExchange,直连式路由，它通过路由键匹配来将消息投递到
对应的队列中去。那么问题来了。<br>
❶问题描述：<br>
有这么一个场景。一家奶制品公司，想分析各城市，各渠道，各产品的销售情况，
从而及时作出运营方案调整。一张订单必然包括城市、渠道、产品等等等信息。
假设武汉地区的区经理想看武汉市的全部渠道全部产品销售情况，用DirectExchange
来做，就是把武汉市的销售订单整理好了，打上&quot;武汉市&quot;这个路由键，发送到交换机上，然后定义一个武汉市
路由键绑定一个队列。(数据收集，数据分析有很多方式，我们这里只是借这么一个场景
，考虑用消息队列去解决消息过滤的问题。)这么做也是可行的，但是又有其他区域
经理要看他们的数据怎么办？我们都要按照他们的城市名筛选好了，打上城市标记，然后
等到交换机投递到各自的队列吗？万一武汉的经理又要看线上销售的情况，又要定义新的
路由键吗？<br>
❷解决方案：<br>
针对上面的场景，假设有10个城市，10种销售渠道，10种产品，那么就有1000种路由键
。还要考虑到一条数据按照城市、渠道、产品等维度的不同组合发送，重复的工作量也就
放大了。再说，业务部门是数据生产方，筛选过滤数据也不应该是他们负责的内容。让他们
过滤数据，打上路由键发送也无疑增加了额外的工作量。<br>
所以这里就要引入TopicExchange
这种交换机，他能按照缺省的路由键进行部分匹配，然后投递。大白话就是，消息生产者，
按照多维度单词指定路由键。如我们这个场景中，一些订单消息的路由键就可以写成：
武汉.淘宝.老年人补钙奶、上海.实体店.早餐奶、杭州.京东.婴幼儿营养奶.....
每个维度之间用英文“.”隔开。消息打上这些组合路由键后，发往TopicExchange。
然后消费者方，可以指定缺省维度的匹配。如“武汉.#”的路由键，就是只要是带有
“武汉”的路由键的订单消息，不区分渠道和产品维度，都会通过该路由键将消息投递到
它绑定的队列上去。如“<em>.淘宝.</em>”的路由键，只生产方带有“淘宝”这个维度的路由键的
消息，都将匹配到“<em>.淘宝.</em>”绑定的队列上去。这里大家也看出来，缺省路由键绑定规则
类似于我们常用的通配符策略。<br>
&quot;#&quot;:代表忽略多个单词，如果路由键整个就是&quot;#&quot;，那么就是全消息匹配了。类似于
你用扇出交换机。<br>
&quot;*&quot;：表示忽略一个单词。如果你全维度都写满(武汉.淘宝.早餐奶)，那就是直连交换机
的精确匹配策略了。<br>
❸实战方案：<br>
我们用一个生产者，模拟生成100条携带“城市.渠道.产品”路由键的消息。然后用三个消费者
创建三种不同维度的缺省路由键去绑定队列，然后观察结果。</p> <h3 id="生产者改造"><a href="#生产者改造" aria-hidden="true" class="header-anchor">#</a> 生产者改造</h3> <p>❶配置Bean:</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TopicExchange</span> <span class="token function">topicExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TopicExchange</span><span class="token punctuation">(</span><span class="token string">&quot;topicExchange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>❷发送消息方法：</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendToTopicExchange</span><span class="token punctuation">(</span><span class="token class-name">String</span> routingKey<span class="token punctuation">,</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>topicExchange<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>routingKey<span class="token punctuation">,</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;发送者 =&gt; &quot;</span><span class="token operator">+</span>topicExchange<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; =&gt; &quot;</span><span class="token operator">+</span>routingKey<span class="token operator">+</span><span class="token string">&quot; =&gt; &quot;</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>❸测试方法：<br>
这里我们用随机数模拟生成随机路由键组合。</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">//自定义常量</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> citys <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;上海&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;广州&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;深圳&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;杭州&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;武汉&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;成都&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;重庆&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;天津&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;厦门&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> channels <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;淘宝&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;京东&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;拼多多&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;微信小程序&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;快手&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;实体店&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> products <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;老年人补钙奶&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;成年人健身奶&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;青少年成长奶&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;婴幼儿营养奶&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;菌多多乳酸菌饮料&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;酸多多酸奶&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;早餐奶&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;代餐奶减肥专供&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">//获取[0，n)区间内的随机整数</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getNum</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取一个随机的城市</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> citys<span class="token punctuation">[</span><span class="token function">getNum</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

   <span class="token comment">//获取一个随机渠道</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> channels<span class="token punctuation">[</span><span class="token function">getNum</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取一个随机产品</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> products<span class="token punctuation">[</span><span class="token function">getNum</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取一个随机路由键</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getRoutingKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;.&quot;</span><span class="token operator">+</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;.&quot;</span><span class="token operator">+</span><span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">topicExchangeSendTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> routingKey <span class="token operator">=</span> <span class="token function">getRoutingKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//消息也放路由键，方便我们打印看效果。</span>
            sender<span class="token punctuation">.</span><span class="token function">sendToTopicExchange</span><span class="token punctuation">(</span>routingKey<span class="token punctuation">,</span>routingKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="消费者一改造"><a href="#消费者一改造" aria-hidden="true" class="header-anchor">#</a> 消费者一改造</h3> <p>❶配置Bean:<br>
消费者一，我们匹配武汉这一个维度的所有订单消息。</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TopicExchange</span> <span class="token function">topicExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TopicExchange</span><span class="token punctuation">(</span><span class="token string">&quot;topicExchange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">orderQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AnonymousQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">bindingAtTopicExchange</span><span class="token punctuation">(</span><span class="token class-name">Queue</span> orderQueue<span class="token punctuation">,</span><span class="token class-name">TopicExchange</span> topicExchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>orderQueue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>topicExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;武汉.#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>❷队列监听器类：</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>david<span class="token punctuation">.</span>mq</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">Queue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">RabbitListener</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author zhoudawei
 * @mail zdw0607@gmail.com
 * @date 2019-11-09 14:44
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TopicQueueReceiver</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">Queue</span> orderQueue<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;#{orderQueue.name}&quot;</span> <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> queueName <span class="token operator">=</span> orderQueue<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;接受者 =&gt; &quot;</span><span class="token operator">+</span>queueName<span class="token operator">+</span><span class="token string">&quot; =&gt; &quot;</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="消费者二改造"><a href="#消费者二改造" aria-hidden="true" class="header-anchor">#</a> 消费者二改造</h3> <p>❶配置Bean:<br>
这里我们匹配三大电商平台渠道的订单消息。</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TopicExchange</span> <span class="token function">topicExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TopicExchange</span><span class="token punctuation">(</span><span class="token string">&quot;topicExchange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">orderQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AnonymousQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">bindingAtTopicExchange1</span><span class="token punctuation">(</span><span class="token class-name">Queue</span> orderQueue<span class="token punctuation">,</span><span class="token class-name">TopicExchange</span> topicExchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>orderQueue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>topicExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;*.淘宝.*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">bindingAtTopicExchange2</span><span class="token punctuation">(</span><span class="token class-name">Queue</span> orderQueue<span class="token punctuation">,</span><span class="token class-name">TopicExchange</span> topicExchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>orderQueue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>topicExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;*.京东.*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">bindingAtTopicExchange3</span><span class="token punctuation">(</span><span class="token class-name">Queue</span> orderQueue<span class="token punctuation">,</span><span class="token class-name">TopicExchange</span> topicExchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>orderQueue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>topicExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;*.拼多多.*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>❷队列监听器类：<br>
跟消费者一样，我就不写了。写到现在，我们都是只给出关键不同地方的代码，其他重复的请大家
自己照着前面的复制一下。</p> <h3 id="消费者三改造"><a href="#消费者三改造" aria-hidden="true" class="header-anchor">#</a> 消费者三改造</h3> <p>讲道理一个应用内可以创建多个队列来监听，但是考虑打印的效果会彼此间穿插交错，不太好肉眼
观察结果，我这里就分多个消费者应用做。前面我们已经有了两个消费者，这里再参照前面的代码，
复制一个消费者出来，端口就叫8083就好了。
❶配置Bean:<br>
消费者三我们去匹配上海早餐奶的订单消息。</p> <div class="language-Java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TopicExchange</span> <span class="token function">topicExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TopicExchange</span><span class="token punctuation">(</span><span class="token string">&quot;topicExchange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">orderQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AnonymousQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">bindingAtTopicExchange1</span><span class="token punctuation">(</span><span class="token class-name">Queue</span> orderQueue<span class="token punctuation">,</span><span class="token class-name">TopicExchange</span> topicExchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>orderQueue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>topicExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;上海.*.早餐奶&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>❷队列监听器类：<br>
跟消费者一样。</p> <h3 id="测试一把"><a href="#测试一把" aria-hidden="true" class="header-anchor">#</a> 测试一把</h3> <p>❶运行生产者发送消息测试方法：<br>
总共发了100条，我们演示就给出部分看看，表示我们是随机生成的100条消息。
<img src="/images/rabbitmq/topicProducer.png" alt=""><br><br>
❷运行三个消费者<br>
我们先看看rabbitmq后台管理页面，绑定关系图。<br> <img src="/images/rabbitmq/topicBinding.png" alt=""><br><br>
然后我们再看看三个消费者的消息打印情况。<br> <img src="/images/rabbitmq/topicAll.png" alt=""><br><br>
这里我们就能清楚的看到。第一列，全部是武汉地区的订单。第二列，全部来自
三大电商平台的订单。第三列是上海地区早餐奶的订单。很显然这种缺省路由键能
更灵活的处理多维度路由的消息过滤。<br>
更多维度的测试，请大家自行修改路由键绑定，去测试。</p> <h3 id="话题交换机"><a href="#话题交换机" aria-hidden="true" class="header-anchor">#</a> 话题交换机</h3> <p>测试完毕，撒花。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/coding/rabbitmq/RabbitMQ基础四之路由.html" class="prev">
          RabbitMQ基础四之路由
        </a></span> <span class="next"><a href="/coding/rabbitmq/RabbitMQ基础六之rpc.html">
          RabbitMQ基础六之rpc
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b72606ea.js" defer></script><script src="/assets/js/2.009073d5.js" defer></script><script src="/assets/js/38.ed229447.js" defer></script>
  </body>
</html>
